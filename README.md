# Тестовое задание для Workmate

HTTP-сервер на Go для проверки доступности веб-ссылок и генерации отчетов в формате PDF.

## Описание проекта

Сервис предоставляет REST API для:
- Проверки доступности веб-ссылок с параллельной обработкой
- Сохранения результатов проверки
- Генерации PDF-отчетов по сохраненным ссылкам
- Корректного завершения работы с сохранением всех данных

### Основные компоненты

- **HTTP слой** (`internal/http/`) — обработка запросов, валидация, DTO
- **Бизнес-логика** (`logic/`) — проверка ссылок, управление хранилищем, генерация PDF
- **Хранилище** — JSON файлы: `storage.json`, `processing.json`, `nextid.json`

## Технологии и возможности

### Используемые технологии
- Go 1.25.0
- Стандартная библиотека HTTP
- `github.com/jung-kurt/gofpdf` — генерация PDF отчетов
- JSON файлы для персистентного хранения

### Реализованные возможности
- **Параллельная обработка** — проверка ссылок выполняется в горутинах
- **Graceful Shutdown** — корректное завершение с обработкой активных запросов
- **Восстановление состояния** — автоматическое восстановление незавершенных задач при старте
- **Синхронизация** — использование мьютексов для thread-safe операций
- **Контексты** — управление жизненным циклом через context.Context
- **Обработка ошибок** — структурированная обработка и возврат ошибок

## API эндпоинты

### POST /add

Добавляет список ссылок, проверяет их доступность и возвращает результаты.

**Запрос:**
```json
{
  "links": ["vk.com", "youtube.com", "music.yandex.ru"]
}
```

**Ответ:**
```json
{
  "links_id": 1,
  "linkList": [
    {
      "url": "vk.com",
      "status": "Available"
    },
    {
      "url": "youtube.com",
      "status": "Not Available"
    },
    {
      "url": "music.yandex.ru",
      "status": "Available"
    }
  ]
}
```

**Описание:**
- Принимает массив URL-адресов (с протоколом или без)
- Проверяет доступность каждой ссылки параллельно
- Сохраняет результаты в хранилище
- Возвращает уникальный идентификатор группы ссылок и их статусы

### POST /report

Генерирует PDF-отчет по указанным идентификаторам групп ссылок.

**Запрос:**
```json
{
  "links_id": [1]
}
```

**Ответ:**
- Возвращает PDF-файл с именем `report.pdf`
- Content-Type: `application/pdf`

**Описание:**
- Принимает массив идентификаторов групп ссылок
- Генерирует PDF-отчет со всеми ссылками и их статусами
- Если идентификатор не найден, он пропускается

### POST /shutdown

Инициирует graceful shutdown сервера.

**Запрос:** без тела (POST без JSON)

**Ответ:**
```
Graceful shutdown инициирован
```

**Описание:**
- Останавливает прием новых запросов
- Дожидается завершения активных запросов (таймаут 30 секунд)
- Корректно завершает работу сервера

## Примеры использования

### Запуск сервера

```bash
go run cmd/main.go
```

Сервер запустится на порту `8080` и будет доступен по адресу `localhost:8080`.



## Особенности реализации

### Проверка доступности ссылок

- Автоматическое добавление протоколов `http://` и `https://` если они не указаны
- Проверка обоих протоколов для максимальной надежности
- Таймаут запроса: 3 секунды
- Ограничение редиректов: максимум 5
- Установка User-Agent заголовка для корректной работы с веб-серверами
- Параллельная проверка всех ссылок в группе через горутины

### Хранилище данных

Проект использует три JSON файла:

- **`storage.json`** — основное хранилище со всеми проверенными ссылками и их статусами
- **`processing.json`** — временное хранилище для ссылок, которые находятся в процессе проверки
- **`nextid.json`** — хранение следующего доступного идентификатора

При каждом запросе `/add`:
1. Ссылки сразу сохраняются в `processing.json` (защита от потери данных)
2. Выполняется проверка доступности
3. Результаты сохраняются в `storage.json`
4. Запись удаляется из `processing.json`

### Graceful Shutdown

Реализован механизм корректного завершения работы:

1. **Обработка сигналов** — перехват `SIGINT` (Ctrl+C) и `SIGTERM` из IDE и консоли
2. **Блокировка новых запросов** — после получения сигнала новые запросы отклоняются с кодом 503
3. **Ожидание активных запросов** — использование `sync.WaitGroup` для отслеживания активных запросов
4. **Таймаут** — максимальное время ожидания завершения запросов: 30 секунд
5. **Сохранение данных** — все данные сохраняются в файлы перед завершением

### Восстановление состояния

При старте сервера автоматически выполняется:

1. Проверка наличия незавершенных задач в `processing.json`
2. Восстановление всех найденных задач
3. Запуск фоновой проверки восстановленных ссылок
4. Сохранение результатов обратно в `storage.json`

Это гарантирует, что данные не будут потеряны даже при неожиданном завершении работы сервера.


## Требования

- Go 1.25.0 или выше
- Доступ к интернету для проверки ссылок



## Разработка

Проект демонстрирует:

- Работу с HTTP протоколом и REST API
- Использование контекстов для управления жизненным циклом
- Параллельную обработку данных через горутины
- Синхронизацию доступа через мьютексы
- Graceful shutdown для корректного завершения сервера
- Работу с файловой системой и JSON
- Генерацию PDF документов
- Разделение ответственности по слоям архитектуры
